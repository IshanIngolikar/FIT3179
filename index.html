<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Australian Healthcare Data Visualization</title>
    <!-- Pure CSS -->
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.1.0/build/pure-min.css">
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        h1, h2, h3 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            text-align: center;
            margin-top: 20px;
        }
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
        }
        .state-select {
            text-align: center;
            margin: 20px 0;
        }
        .chart-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .chart-container {
            background-color: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 1 1 calc(50% - 20px); /* Two charts per row */
            min-width: 300px;
            box-sizing: border-box;
        }
        .full-width-chart {
            flex: 1 1 100%;
        }
        .chart-title {
            text-align: center;
            margin-bottom: 10px;
        }
        .annotation {
            font-style: italic;
            color: #555;
            text-align: center;
            margin-bottom: 10px;
        }
        /* Adjust chart heights */
        #map, #bedperperson {
            height: 600px; /* Increased height for maps and treemap */
        }
        #expenditure_tree
        {
          height: 360px; 
        }
        #sectoranalysis {
            height: 100px; /* Pie chart height */
        }
        /* Ensure charts are responsive */
        .chart-content {
            width: 100%;
            height: 100%;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .chart-container {
                flex: 1 1 100%;
            }
        }
    </style>
    <!-- Vega & Vega-Lite -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5.25.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.15.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.22.2"></script>
</head>
<body>

<div class="container">
    <h1>Australian Healthcare Data Visualization</h1>
    
    <!-- State Selection Dropdown -->
    <div class="state-select">
        <label for="state-select"><strong>Select a State or Territory:</strong></label>
        <select id="state-select">
            <option value="">All States and Territories</option>
            <option>Australian Capital Territory</option>
            <option>New South Wales</option>
            <option>Northern Territory</option>
            <option>Queensland</option>
            <option>South Australia</option>
            <option>Tasmania</option>
            <option>Victoria</option>
            <option>Western Australia</option>
        </select>
    </div>
    
    <!-- Charts Section -->
    <div class="chart-grid">
        <!-- First Row: Two Charts Side by Side -->
        <div class="chart-container">
            <h3 class="chart-title">Hospital Distribution Map</h3>
            <p class="annotation">Distribution of hospitals across regions.</p>
            <div id="map" class="chart-content"></div>
        </div>
        <div class="chart-container">
            <h3 class="chart-title">Beds Per Person</h3>
            <p class="annotation">Density of hospital beds per population.</p>
            <div id="bedperperson" class="chart-content"></div>
        </div>
        <!-- Second Row: Full Width Pie Chart -->
        <div class="chart-container full-width-chart">
            <h3 class="chart-title">Sector Analysis</h3>
            <p class="annotation">Public vs Private sector distribution.</p>
            <div id="sectoranalysis" class="chart-content"></div>
        </div>
        <!-- Third Row: Two Charts Side by Side -->
        <div class="chart-container">
            <h3 class="chart-title">Expenditure Breakdown</h3>
            <p class="annotation">Allocation of healthcare funding.</p>
            <div id="expenditure_tree" class="chart-content"></div>
        </div>
        <div class="chart-container">
            <h3 class="chart-title">Expenditure Over Time</h3>
            <p class="annotation">Trends in healthcare spending.</p>
            <div id="expenditure_line" class="chart-content"></div>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stateAbbreviations = {
            "Australian Capital Territory": "ACT",
            "New South Wales": "NSW",
            "Northern Territory": "NT",
            "Queensland": "QLD",
            "South Australia": "SA",
            "Tasmania": "TAS",
            "Victoria": "VIC",
            "Western Australia": "WA"
        };
    
        // Function to embed a chart with dynamic specification adjustments for maps
        function embedMapChart(elementId, specPath, selectedState) {
            fetch(specPath)
            .then(response => response.json())
            .then(vlSpec => {
                const originalLayerCount = vlSpec.layer.length;

                // Modify only the map-related specifications for graticules
                if (selectedState === null) {
                    // Add graticules layer when selectedState is null, specifically for map charts
                    vlSpec.layer.push({
                        "data": {
                            "url": "https://raw.githubusercontent.com/IshanIngolikar/FIT3179/refs/heads/w9/output.json",
                            "format": {"type": "topojson", "feature": "ne_10m_graticules_15"}
                        },
                        "mark": {
                            "type": "geoshape",
                            "stroke": "black",
                            "strokeWidth": 0.5
                        }
                    });
                } else {
                    // Restore to original layers if state is selected
                    vlSpec.layer = vlSpec.layer.slice(0, originalLayerCount);
                }

                vegaEmbed("#" + elementId, vlSpec, {"actions": false}).then(function(result) {
                    result.view.signal("selectedState", selectedState).run();
                }).catch(console.error);
            });
        }

        // Function to embed non-map charts, unchanged
        function embedChart(elementId, specPath, selectedState) {
            vegaEmbed("#" + elementId, specPath, {"actions": false}).then(function(result) {
                if (selectedState) {
                    result.view.signal("selectedState", selectedState).run();
                }
            }).catch(console.error);
        }

        // Initial embedding with no state selected
        embedChart("sectoranalysis", "vega/pie.vg.json", null);
        embedChart("expenditure_tree", "vega/treemap.vg.json", null);
        embedChart("expenditure_line", "vega/expenditure.vg.json", null);
        embedMapChart("map", "vega/proportional.vg.json", null);
        embedMapChart("bedperperson", "vega/choropleth.vg.json", null);

        // Add event listener to the drop-down
        document.getElementById("state-select").addEventListener("change", function() {
            var selectedState = this.value || null;
            embedMapChart("map", "vega/proportional.vg.json", selectedState);
            embedMapChart("bedperperson", "vega/choropleth.vg.json", selectedState);
            embedChart("sectoranalysis", "vega/pie.vg.json", selectedState);
            embedChart("expenditure_tree", "vega/treemap.vg.json", selectedState);
            var stateAbbrev = stateAbbreviations[selectedState] || null;
            embedChart("expenditure_line", "vega/expenditure.vg.json", stateAbbrev);
        });
    });
</script>

</body>
</html>
